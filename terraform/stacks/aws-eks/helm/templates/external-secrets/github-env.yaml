{{/*
Purpose:
- Optional ExternalSecret for the GitHub integration.
- Pulls GitHub-related secrets from SSM and emits env-var-shaped keys.
*/}}

{{- if .Values.integrations.github.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-env
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: greptile-ssm
    kind: SecretStore
  target:
    name: github-env
    creationPolicy: Owner
  data:
    - secretKey: GITHUB_CLIENT_ID
      remoteRef:
        key: {{ printf "%s/config/github-client-id" .Values.ssm.prefix | quote }}
    - secretKey: GITHUB_CLIENT_SECRET
      remoteRef:
        key: {{ printf "%s/secrets/github-client-secret" .Values.ssm.prefix | quote }}
    - secretKey: WEBHOOK_SECRET
      remoteRef:
        key: {{ printf "%s/secrets/github-webhook-secret" .Values.ssm.prefix | quote }}
    - secretKey: GITHUB_PRIVATE_KEY
      remoteRef:
        key: {{ printf "%s/secrets/github-private-key" .Values.ssm.prefix | quote }}
{{- end }}
