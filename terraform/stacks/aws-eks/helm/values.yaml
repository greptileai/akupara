# Purpose:
# - Default configuration for the Greptile EKS Helm chart.
# - Keeps a stable contract for Terraform-injected values (see `terraform/stacks/aws-eks/helm-values.yaml.tpl`).
# Values injected by Terraform (see terraform/stacks/aws-eks/helm-values.yaml.tpl)

global:
  region: ""
  environment: ""

ssm:
  prefix: ""
  kmsKeyArn: ""

ecr:
  registry: ""

greptile:
  tag: ""

irsa:
  externalSecrets: ""
  indexer: ""
  query: ""
  github: ""
  gitlab: ""
  cloudwatch: ""

database:
  host: ""
  port: 5432
  # Name/user/password are sourced from SSM via ExternalSecrets.

redis:
  host: ""
  port: 6379
  useTls: true
  # Password is sourced from SSM via ExternalSecrets.

cloudwatchLogs:
  enabled: true
  logGroupName: ""

external-secrets:
  install: true
  installCRDs: true
  webhook:
    create: true
  certController:
    create: true

hatchet-stack:
  enabled: true
  # We provide `hatchet-shared-config` via ExternalSecrets so we can inject DATABASE_URL from SSM
  sharedConfig:
    enabled: false
  caddy:
    enabled: false
  postgres:
    enabled: false
  rabbitmq:
    enabled: true
    auth:
      username: "hatchet"
      password: "hatchet"

hatchet:
  tenantId: "707d0855-80ab-4e1f-a156-f1c4546cbf52"
  tokenGeneration:
    enabled: true
    backoffLimit: 10
  ingress:
    enabled: true
    # Optional: set to a DNS name to scope routing to a specific host.
    # If empty, the Ingress will match all hosts (useful with the autogenerated ALB DNS).
    host: ""
    # Extra annotations for the ALB Ingress (e.g., Cognito/OIDC auth, TLS cert ARN, etc).
    annotations: {}
  sharedConfig:
    serverUrl: "http://localhost:8080"
    serverAuthCookieDomain: "localhost:8080"
    serverAuthCookieInsecure: "t"
    serverAuthSetEmailVerified: "t"
    serverAuthBasicAuthEnabled: "t"
    grpcBroadcastAddress: "greptile-engine:7070"
    grpcInsecure: "true"
    defaultAdminEmail: "admin@example.com"
    defaultAdminPassword: "Admin123!!"

migrations:
  enabled: true
  backoffLimit: 1

api:
  enabled: true
  replicaCount: 1
  service:
    type: ClusterIP
    port: 3002
  resources: {}

auth:
  enabled: true
  replicaCount: 1
  service:
    type: ClusterIP
    port: 3001
  resources: {}

web:
  enabled: true
  replicaCount: 1
  service:
    type: LoadBalancer
    port: 3000
  resources: {}

webhook:
  enabled: false
  replicaCount: 1
  service:
    type: LoadBalancer
    port: 3007
  resources: {}

query:
  enabled: true
  replicaCount: 3
  service:
    type: ClusterIP
    port: 8081
  resources: {}

indexer:
  enabled: true
  replicaCount: 2
  service:
    type: ClusterIP
    chunkerPort: 3003
    summarizerPort: 3004
  resources: {}

integrations:
  github:
    enabled: false
    replicaCount: 1
    service:
      type: ClusterIP
      port: 3010
    resources: {}
  gitlab:
    enabled: false
    replicaCount: 1
    service:
      type: ClusterIP
      port: 3011
    resources: {}

jackson:
  enabled: false
  replicaCount: 1
  service:
    type: ClusterIP
    port: 5225
  resources: {}

llm:
  enabled: false
